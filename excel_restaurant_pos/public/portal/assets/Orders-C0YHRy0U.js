import{f as _,F as j,e as C,Z as R,H as k,r as b,_ as N,j as a}from"./index-BQ2drNvc.js";const S=()=>{var f;const{currentUser:g}=_(),{data:h}=j(`excel_restaurant_pos.api.item.get_roles?user=${g}`),e=(f=h==null?void 0:h.message)==null?void 0:f.map(t=>t==null?void 0:t.Role);console.log({userRoles:e}),console.log(g);const u=[{id:1,state:"Order Placed",action:"Accept",nextState:"Work in progress",allowed:"Restaurant Waiter"},{id:2,state:"Order Placed",action:"Reject",nextState:"Canceled",allowed:"Restaurant Waiter"},{id:3,state:"Work in progress",action:"Ready",nextState:"Ready for Pickup",allowed:"Restaurant Chef"},{id:3,state:"Work in progress",action:"Reject",nextState:"Canceled",allowed:"Restaurant Chef"},{id:4,state:"Ready for Pickup",action:"Completed",nextState:"Completed",allowed:"Restaurant Manager"}],{data:p,mutate:x}=j("excel_restaurant_pos.api.item.get_order_list",["*"]),c=p==null?void 0:p.message;console.log(c);const v=(t,n)=>u.filter(s=>(s==null?void 0:s.state)===t&&(n==null?void 0:n.includes(s==null?void 0:s.allowed)));C("Table Order",t=>{console.log("Event data:",t)}),R("Table Order","on_update",t=>{x(),console.log("Event data:",t)});const{updateDoc:w}=k(),y=(t,n,s,i)=>{const d=u==null?void 0:u.find(l=>(l==null?void 0:l.state)===n&&(s==null?void 0:s.includes(l==null?void 0:l.allowed))&&(l==null?void 0:l.action)===i);if(d){const l=d.nextState,o={status:l};l==="Completed"&&(o.docstatus=1),w("Table Order",t,o).then(m=>{m&&(console.log("Order status updated successfully:",m),x())}).catch(m=>{console.log("Error updating order status:",m)})}else console.log("Invalid transition for the current state and role.")};return b.useEffect(()=>{const t=setInterval(()=>{x()},1e4);return()=>clearInterval(t)},[x]),b.useEffect(()=>{console.log("userRoles",e);const t=c==null?void 0:c.filter(i=>(i==null?void 0:i.status)==="Order Placed"),n=(e==null?void 0:e.includes("Restaurant Manager"))||(e==null?void 0:e.includes("Restaurant Waiter"));e==null||e.includes("Restaurant Chef"),n&&(t==null?void 0:t.length)>0&&N.success("There is an order placed but not sent to kitchen yet");const s=c==null?void 0:c.filter(i=>(i==null?void 0:i.status)==="Work in progress");n&&(s==null?void 0:s.length)>0&&N.success("There is an order in progress")},[c]),a.jsxs("div",{className:"p-4",children:[a.jsx("h2",{className:"font-semibold text-xl mb-4",children:"Orders"}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:c==null?void 0:c.map(t=>{var n;return a.jsxs("div",{className:"bg-white shadow-lg rounded-md p-4",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h3",{className:"text-xl font-semibold",children:t==null?void 0:t.name}),a.jsx("div",{className:"text-sm text-gray-500",children:t!=null&&t.table?t==null?void 0:t.table:"Parcel"})]}),a.jsxs("div",{className:"mt-2 text-sm",children:[a.jsxs("p",{className:"font-semibold",children:["Total: ৳",t==null?void 0:t.total_amount]}),a.jsxs("p",{className:"font-semibold",children:["Status: ",t==null?void 0:t.status]})]}),(t==null?void 0:t.remarks)&&a.jsxs("div",{className:"mt-2 text-sm ",children:[a.jsx("strong",{children:"Note:"})," ",t==null?void 0:t.remarks]}),a.jsxs("div",{className:"mt-4",children:[a.jsx("h4",{className:"font-semibold mb-2",children:"Items:"}),a.jsx("ul",{className:"list-none space-y-2",children:(n=t==null?void 0:t.item_list)==null?void 0:n.map((s,i)=>a.jsxs("li",{className:"flex justify-between text-xs",children:[a.jsx("span",{children:s==null?void 0:s.item}),a.jsxs("span",{children:["৳",s==null?void 0:s.rate," x ",s==null?void 0:s.qty]})]},i))})]}),a.jsx("div",{className:"mt-4 w-fit flex h-fit gap-4",children:v(t==null?void 0:t.status,e).map(s=>a.jsx("button",{onClick:()=>y(t==null?void 0:t.name,t==null?void 0:t.status,e,s==null?void 0:s.action),className:"w-full bg-primaryColor text-white py-1.5 px-4 rounded",children:s.action},s.action))})]},t.name)})})]})};export{S as default};
