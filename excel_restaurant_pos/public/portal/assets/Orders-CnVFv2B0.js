import{f as k,F as g,r as N,H as _,e as O,Z as v,j as e,_ as u}from"./index-yg_IsvUt.js";const A=()=>{var j;const{currentUser:f}=k(),{data:b}=g(`excel_restaurant_pos.api.item.get_roles?user=${f}`),m=(j=b==null?void 0:b.message)==null?void 0:j.map(s=>s==null?void 0:s.Role),n=[{id:1,state:"Order Placed",action:"Accept",nextState:"Work in progress",allowed:"Restaurant Waiter"},{id:2,state:"Order Placed",action:"Reject",nextState:"Canceled",allowed:"Restaurant Waiter"},{id:3,state:"Work in progress",action:"Ready",nextState:"Ready for Pickup",allowed:"Restaurant Chef"},{id:4,state:"Work in progress",action:"Reject",nextState:"Canceled",allowed:"Restaurant Chef"},{id:5,state:"Ready for Pickup",action:"Completed",nextState:"Completed",allowed:"Restaurant Manager"},{id:6,state:"Ready for Pickup",action:"Completed",nextState:"Completed",allowed:"Restaurant Cashier"}],[r,y]=N.useState(""),{data:h,mutate:p}=g(`excel_restaurant_pos.api.item.get_order_list?status=${r?encodeURIComponent(r):""}`,["*"]),i=h==null?void 0:h.message,R=(s,d)=>n==null?void 0:n.filter(l=>(l==null?void 0:l.state)===s&&(d==null?void 0:d.includes(l==null?void 0:l.allowed))),{updateDoc:C}=_(),w=(s,d,l,o)=>{const a=n==null?void 0:n.find(t=>(t==null?void 0:t.state)===d&&(l==null?void 0:l.includes(t==null?void 0:t.allowed))&&(t==null?void 0:t.action)===o);if(a){const t=a.nextState,x={status:t};t==="Completed"&&(x.docstatus=1),C("Table Order",s,x).then(c=>{c&&(u.success("Order status updated successfully!"),p())}).catch(c=>{u.error("Error updating order status."),console.log("Error updating order status:",c)})}else u.error("Invalid transition for the current state and role.")},S=s=>{const d=["bg-gray-100","bg-blue-100","bg-green-100","bg-yellow-100","bg-pink-100"];return d[s%d.length]};return O("Table Order",()=>{p(),console.log("Order List Updated")}),v("Table Order","on_update",s=>{p(),console.log("Event data:",s)}),N.useEffect(()=>{p()},[r,p]),e.jsxs("div",{className:"p-6 bg-white shadow-md rounded-lg",children:[e.jsx("h2",{className:"font-semibold text-2xl text-gray-800 mb-6",children:"Orders"}),e.jsxs("div",{className:"mb-4",children:[["Order Placed","Work in progress","Ready for Pickup","Completed","Canceled"].map(s=>e.jsxs("label",{className:"inline-flex items-center mr-4",children:[e.jsx("input",{type:"checkbox",checked:r===s,onChange:()=>y(r===s?"":s),className:"form-checkbox"}),e.jsx("span",{className:"ml-2",children:s})]},s)),e.jsx("button",{onClick:()=>y(""),className:"ml-4 bg-gray-300 text-gray-700 py-2 px-4 rounded",children:"Reset"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200 text-gray-700 text-left",children:[e.jsx("th",{className:"px-4 py-2 border-b",children:"Order ID"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Table"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Status"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Total Amount"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Item Name"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"QTY"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Rate"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 border-b",children:" Item Status"}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Delivery Status "}),e.jsx("th",{className:"px-4 py-2 border-b",children:"Action"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-300",children:[" ",i==null?void 0:i.map((s,d)=>{var o;const l=S(d);return e.jsxs(e.Fragment,{children:[(o=s==null?void 0:s.item_list)==null?void 0:o.map((a,t)=>{var x;return e.jsxs("tr",{className:`${l}  hover:bg-gray-50`,children:[t===0?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-2 border-b",children:s==null?void 0:s.name}),e.jsx("td",{className:"px-4 py-2 border-b",children:(s==null?void 0:s.table)||"Parcel"}),e.jsx("td",{className:"px-4 py-2 border-b",children:s==null?void 0:s.status}),e.jsx("td",{className:"px-4 py-2 border-b",children:s==null?void 0:s.total_amount})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"px-4 py-2 border-b"}),e.jsx("td",{className:"px-4 py-2 border-b"}),e.jsx("td",{className:"px-4 py-2 border-b"}),e.jsx("td",{className:"px-4 py-2 border-b"})]}),e.jsx("td",{className:"px-4 py-2 border-b",children:a==null?void 0:a.item}),e.jsx("td",{className:"px-4 py-2 border-b",children:a==null?void 0:a.qty}),e.jsx("td",{className:"px-4 py-2 border-b",children:a==null?void 0:a.rate}),e.jsx("td",{className:"px-4 py-2 border-b",children:a==null?void 0:a.amount}),e.jsx("td",{className:"px-4 py-2 border-b",children:a!=null&&a.is_parcel?"Parcel":"Dining"}),e.jsx("td",{className:"px-4 py-2 border-b",children:a!=null&&a.is_ready?"Ready":"Not Ready"}),t===0?e.jsx("td",{className:"px-4 py-2  flex gap-3",children:(x=R(s==null?void 0:s.status,m))==null?void 0:x.map(c=>e.jsx("button",{onClick:()=>w(s==null?void 0:s.name,s==null?void 0:s.status,m,c==null?void 0:c.action),className:"w-full bg-primaryColor text-white py-1.5 px-4 rounded",children:c==null?void 0:c.action},c.action))}):e.jsx("td",{})]},`${s.name}-${t}`)}),e.jsx("tr",{className:"bg-white",children:e.jsx("td",{colSpan:11,className:"h-5"})})]})})]})]})})]})};export{A as default};
