import{f as R,F as j,e as v,Z as y,H as C,j as s}from"./index-CQ_cVJCS.js";const S=()=>{var h;const{currentUser:m}=R(),{data:d}=j(`excel_restaurant_pos.api.item.get_roles?user=${m}`),o=(h=d==null?void 0:d.message)==null?void 0:h.map(e=>e==null?void 0:e.Role);console.log({userRoles:o}),console.log(m);const c=[{id:1,state:"Order Placed",action:"Accept",nextState:"Work in progress",allowed:"Restaurant Waiter"},{id:2,state:"Order Placed",action:"Reject",nextState:"Canceled",allowed:"Restaurant Waiter"},{id:3,state:"Work in progress",action:"Ready",nextState:"Ready for Pickup",allowed:"Restaurant Chef"},{id:3,state:"Work in progress",action:"Reject",nextState:"Canceled",allowed:"Restaurant Chef"},{id:4,state:"Ready for Pickup",action:"Completed",nextState:"Completed",allowed:"Restaurant Manager"}],{data:x,mutate:p}=j("excel_restaurant_pos.api.item.get_order_list",["*"]),n=x==null?void 0:x.message;console.log(n);const b=(e,l)=>c.filter(t=>(t==null?void 0:t.state)===e&&(l==null?void 0:l.includes(t==null?void 0:t.allowed)));v("Table Order",e=>{console.log("Event data:",e)}),y("Table Order","on_update",e=>{p(),console.log("Event data:",e)});const{updateDoc:N}=C(),w=(e,l,t,u)=>{const g=c==null?void 0:c.find(a=>(a==null?void 0:a.state)===l&&(t==null?void 0:t.includes(a==null?void 0:a.allowed))&&(a==null?void 0:a.action)===u);if(g){const a=g.nextState,f={status:a};a==="Completed"&&(f.docstatus=1),N("Table Order",e,f).then(i=>{i&&(console.log("Order status updated successfully:",i),p())}).catch(i=>{console.log("Error updating order status:",i)})}else console.log("Invalid transition for the current state and role.")};return s.jsxs("div",{className:"p-4",children:[s.jsx("h2",{className:"font-semibold text-xl mb-4",children:"Orders"}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:n==null?void 0:n.map(e=>{var l;return s.jsxs("div",{className:"bg-white shadow-lg rounded-md p-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-xl font-semibold",children:e==null?void 0:e.name}),s.jsx("div",{className:"text-sm text-gray-500",children:e.table})]}),s.jsxs("div",{className:"mt-2 text-sm",children:[s.jsxs("p",{className:"font-semibold",children:["Total: ৳",e==null?void 0:e.total_amount]}),s.jsxs("p",{className:"font-semibold",children:["Status: ",e==null?void 0:e.status]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Items:"}),s.jsx("ul",{className:"list-none space-y-2",children:(l=e.item_list)==null?void 0:l.map((t,u)=>s.jsxs("li",{className:"flex justify-between text-xs",children:[s.jsx("span",{children:t==null?void 0:t.item}),s.jsxs("span",{children:["৳",t==null?void 0:t.rate," x ",t==null?void 0:t.qty]})]},u))})]}),s.jsx("div",{className:"mt-4 w-fit flex h-fit gap-4",children:b(e==null?void 0:e.status,o).map(t=>s.jsx("button",{onClick:()=>w(e==null?void 0:e.name,e==null?void 0:e.status,o,t==null?void 0:t.action),className:"w-full bg-primaryColor text-white py-1.5 px-4 rounded",children:t.action},t.action))})]},e.name)})})]})};export{S as default};
