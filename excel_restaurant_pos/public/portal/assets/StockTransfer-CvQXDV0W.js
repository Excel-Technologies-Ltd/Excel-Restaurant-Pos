var Q=Object.defineProperty,z=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var L=(s,a,t)=>a in s?Q(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,y=(s,a)=>{for(var t in a||(a={}))H.call(a,t)&&L(s,t,a[t]);if(B)for(var t of B(a))J.call(a,t)&&L(s,t,a[t]);return s},S=(s,a)=>z(s,G(a));var M=(s,a,t)=>new Promise((h,p)=>{var d=c=>{try{i(t.next(c))}catch(f){p(f)}},r=c=>{try{i(t.throw(c))}catch(f){p(f)}},i=c=>c.done?h(c.value):Promise.resolve(c.value).then(d,r);i((t=t.apply(s,a)).next())});import{r as b,x as T,W as K,j as e,y as _,$ as w}from"./index-Bxetnfjv.js";function X(){var k,q,C,D,I,$,E;const[s,a]=b.useState(""),[t,h]=b.useState(""),[p,d]=b.useState(""),[r,i]=b.useState([{item_code:"",qty:void 0,searchText:""}]),[c,f]=b.useState(""),o=T(c,300),[u,n]=b.useState(""),g=T(u,300),{createDoc:A,loading:W,error:j}=K(),P=()=>w("Warehouse",{fields:["name"],orderBy:{field:"name",order:"asc"},filters:o?[["name","like",`%${o}%`]]:void 0}),R=()=>w("Warehouse",{fields:["name"],orderBy:{field:"name",order:"asc"},filters:g?[["name","like",`%${g}%`]]:void 0}),F=l=>M(this,null,function*(){if(l.preventDefault(),d(""),(r==null?void 0:r.length)===0){d("Please add at least one item.");return}if(!s||!t){d("Please select source and target warehouse.");return}if(s===t){d("Source and target warehouse cannot be the same.");return}try{const m=r.filter(x=>x.item_code&&x.qty&&x.qty>0).map(x=>({item_code:x.item_code,qty:x.qty})),N={doctype:"Stock Entry",stock_entry_type:"Material Transfer",from_warehouse:s,to_warehouse:t,docstatus:1,items:m==null?void 0:m.map(x=>({item_code:x.item_code,qty:x.qty,s_warehouse:s,t_warehouse:t}))},v=yield A("Stock Entry",N);v!=null&&v.name?d("Stock transferred successfully."):d("Transfer completed."),a(""),h(""),i([{item_code:"",qty:void 0,searchText:""}])}catch(m){const N=m==null?void 0:m.message;d("stock transfer failed: "+N)}});return e.jsxs("div",{className:"p-4 md:p-6",children:[e.jsx("h1",{className:"text-xl font-semibold mb-4",children:"Stock Transfer"}),e.jsxs("form",{onSubmit:F,className:"space-y-4 max-w-4xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Source Warehouse"}),e.jsx(_,{options:(C=(q=(k=P())==null?void 0:k.data)==null?void 0:q.map(l=>l.name))!=null?C:[],value:s,onChange:l=>a(l),searchText:c,onSearchTextChange:f,placeholder:"Search warehouses..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Warehouse"}),e.jsx(_,{options:($=(I=(D=R())==null?void 0:D.data)==null?void 0:I.map(l=>l.name))!=null?$:[],value:t,onChange:h,searchText:u,onSearchTextChange:n,placeholder:"Search warehouses..."})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-base font-semibold",children:"Items"}),e.jsx("button",{type:"button",onClick:()=>i(l=>[...l,{item_code:"",qty:void 0,searchText:""}]),className:"bg-green-600 text-white px-3 py-1 rounded",children:"Add Row"})]}),e.jsx("div",{className:"overflow-auto border rounded p-3 max-h-[500px]",children:e.jsxs("table",{className:"min-w-[580px] w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2",children:"Item"}),e.jsx("th",{className:"text-left p-2 w-40",children:"Qty"}),e.jsx("th",{className:"p-2 w-24",children:"Actions"})]})}),e.jsx("tbody",{children:r==null?void 0:r.map((l,m)=>e.jsx(O,{row:l,index:m,rows:r,setRows:i},m))})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"submit",disabled:W,className:"bg-primaryColor text-white px-4 py-2 rounded disabled:opacity-60",children:W?"Creating...":"Create"}),j&&e.jsx("span",{className:"text-red-600 text-sm",children:(E=j==null?void 0:j.message)!=null?E:"Failed"}),p&&!j&&e.jsx("span",{className:"text-green-700 text-sm",children:p})]})]})]})}function O({row:s,index:a,rows:t,setRows:h}){var r,i,c,f;const p=T(s.searchText,300),d=()=>w("Item",{fields:["name"],orderBy:{field:"modified",order:"desc"},filters:p?[["disabled","=",0],["name","like",`%${p}%`]]:[["disabled","=",0]],limit:50});return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:e.jsx(_,{options:(c=(i=(r=d())==null?void 0:r.data)==null?void 0:i.map(o=>o.name))!=null?c:[],value:s.item_code,onChange:o=>h(u=>u.map((n,g)=>g===a?S(y({},n),{item_code:o}):n)),searchText:s.searchText,onSearchTextChange:o=>h(u=>u.map((n,g)=>g===a?S(y({},n),{searchText:o}):n)),placeholder:"Search items..."})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",required:!0,min:0,step:.001,value:(f=s.qty)!=null?f:"",onChange:o=>h(u=>u.map((n,g)=>g===a?S(y({},n),{qty:Number(o.target.value)}):n)),className:"w-full border rounded px-2 py-1 focus:outline-none focus:ring",placeholder:"0"})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("button",{type:"button",onClick:()=>h(o=>o.filter((u,n)=>n!==a)),className:"text-red-600 hover:underline",disabled:t.length===1,children:"Remove"})})]})}export{X as default};
