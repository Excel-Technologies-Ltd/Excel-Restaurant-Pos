var ge=Object.defineProperty,je=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var Y=(d,n,c)=>n in d?ge(d,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):d[n]=c,j=(d,n)=>{for(var c in n||(n={}))ye.call(n,c)&&Y(d,c,n[c]);if(W)for(var c of W(n))ve.call(n,c)&&Y(d,c,n[c]);return d},N=(d,n)=>je(d,Ne(n));var R=(d,n,c)=>new Promise((w,l)=>{var m=u=>{try{b(c.next(u))}catch(p){l(p)}},f=u=>{try{b(c.throw(u))}catch(p){l(p)}},b=u=>u.done?w(u.value):Promise.resolve(u.value).then(m,f);b((c=c.apply(d,n)).next())});import{r as x,u as B,F as I,K as G,j as s,R as we,L as X,c as Ce,d as Se,_ as Z,N as Q,f as _e,U as ke,g as Le,B as Pe,s as Fe,C as qe}from"./index-Bxetnfjv.js";const ze=({isOpen:d,toggleDrawer:n,setShowPopup:c,isAdmin:w=!1})=>{const[l,m]=x.useState([]),[f,b]=x.useState({}),[u,p]=x.useState(""),[A,F]=x.useState(""),[S,J]=x.useState(""),[y,g]=x.useState(""),[C,q]=x.useState("percentage"),{updateCartCount:_,cartCount:ee}=B(),[M,z]=x.useState(!1),[E,se]=x.useState(""),[k,te]=x.useState("");x.useState(""),localStorage.getItem("table_id");const{data:D}=I("excel_restaurant_pos.api.item.get_tax_rate"),U=D==null?void 0:D.message,{call:ae}=G("excel_restaurant_pos.api.item.check_coupon_code"),{data:T,mutate:$}=I(`excel_restaurant_pos.api.item.get_running_order_item_list?table_id=${k}`),i=T==null?void 0:T.message,{call:le,loading:De,error:Te,result:$e}=G("excel_restaurant_pos.api.item.create_order");x.useEffect(()=>{const e=JSON.parse(localStorage.getItem("cart")||"[]");if(e.length>0){m(e);const a=e.reduce((o,r)=>(o[r==null?void 0:r.item_code]=r.quantity,o),{});b(a)}},[ee]);const ne=e=>{b(a=>N(j({},a),{[e]:(a[e]||0)+1})),m(a=>{const o=a==null?void 0:a.map(r=>r.item_code===e?N(j({},r),{quantity:(f[e]||0)+1}):r);return localStorage.setItem("cart",JSON.stringify(o)),_(),o})},H=e=>{b(a=>N(j({},a),{[e]:(a[e]||1)>1?a[e]-1:1})),m(a=>{const o=a.map(r=>r.item_code===e&&r.quantity>1?N(j({},r),{quantity:f[e]-1}):r);return localStorage.setItem("cart",JSON.stringify(o)),_(),o})},ce=e=>{const a=l.filter(o=>o.item_code!==e);m(a),localStorage.setItem("cart",JSON.stringify(a)),_()},oe=JSON.parse(localStorage.getItem("cart")||"[]"),v=l.reduce((e,a)=>e+Number(a.price||0)*Number(a.quantity||0),0),L=(v-Number(u))*U,P=isNaN(v-Number(u)+L)?0:v-Number(u)+L,re=()=>{if(l.length===0){Z.error("Your cart is empty! Please add items to checkout.");return}z(!0)},de=(e,a)=>{const o=e.target.checked;m(h=>h.map(t=>t.item_code==a?N(j({},t),{isParcel:o}):t));const r=l.map(h=>h.item_code==a?N(j({},h),{isParcel:o}):h);localStorage.setItem("cart",JSON.stringify(r))},xe=()=>R(void 0,null,function*(){var r,h;const e=JSON.parse(localStorage.getItem("cart")||"[]"),o={customer:"Room One",item_list:e==null?void 0:e.map(t=>({item:t==null?void 0:t.item_code,qty:t==null?void 0:t.quantity,rate:t==null?void 0:t.price,amount:(t==null?void 0:t.price)*(t==null?void 0:t.quantity),is_parcel:t!=null&&t.isParcel?1:0})),table:k||localStorage.getItem("table_id"),full_name:E||"Test User",remarks:A,discount_type:C,total_amount:Number(P),tax:Number(L),discount:Number(u),amount:Number(v)};try{const t=yield le({data:o});((r=t==null?void 0:t.message)==null?void 0:r.status)==="success"?(p(""),q("percentage"),g(""),m([]),b({}),F(""),localStorage.removeItem("cart"),localStorage.setItem("checkoutPrice",JSON.stringify(P)),c(!0),n(),_(),$(),z(!1)):Z.error((h=t==null?void 0:t.message)==null?void 0:h.message)}catch(t){console.log("error",t)}}),ue=()=>{p(""),q("percentage"),g(""),b({}),n(),F("")},ie=e=>{const a=e.target.value,o=Number(a);if(C==="percentage"&&(o<0||o>100)){g("Discount must be between 0 and 100.");return}else if(C==="flat"&&o<0){g("Flat discount cannot be negative.");return}g(""),p(a)},he=e=>{q(e.target.value),p(""),g("")},me=()=>{S&&ae({data:{coupon_code:S}}).then(e=>{var a,o,r,h,t,K,V;if(((a=e==null?void 0:e.message)==null?void 0:a.status)==="success"){g("");const fe=((o=e==null?void 0:e.message)==null?void 0:o.discount_type)==="percentage"?v*Number((h=(r=e==null?void 0:e.message)==null?void 0:r.amount)!=null?h:0)/100:Number((K=(t=e==null?void 0:e.message)==null?void 0:t.amount)!=null?K:0);p(String(fe)),J("")}else g((V=e==null?void 0:e.message)==null?void 0:V.message),p("")})},[O,pe]=x.useState(window.innerWidth>768);x.useEffect(()=>{$();const e=()=>{pe(window.innerWidth>768)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),x.useEffect(()=>{const e=document.querySelector(".modal-scrollable");return d?(document.body.classList.add("modal-open"),e==null||e.classList.remove("modal-scrollable"),e==null||e.classList.add("foodsBody")):(document.body.classList.remove("modal-open"),e==null||e.classList.remove("foodsBody"),e==null||e.classList.add("modal-scrollable")),()=>{document.body.classList.remove("modal-open"),e==null||e.classList.remove("foodsBody"),e==null||e.classList.add("modal-scrollable")}},[d]);const be=()=>R(void 0,null,function*(){const e=yield localStorage.getItem("table_id");te(e||"")});return x.useEffect(()=>{be(),k&&$()},[M]),s.jsxs(Ee,{isOpen:d,isLargeDevice:O,children:[s.jsxs("div",{className:`overflow-y-auto p-4 z-50 ${O?" max-h-[calc(100vh-100px)] pb-24":"max-h-[100vh] pb-20"}`,children:[s.jsxs("div",{className:"flex justify-between border-b",children:[s.jsx("h2",{className:"font-semibold",children:(l==null?void 0:l.length)>1?"Carts":"Cart"}),s.jsx("button",{className:"bg-gray-50 h-8 w-8 border rounded-full mb-3 flex items-center justify-center",onClick:ue,children:s.jsx(we,{})})]}),s.jsxs("div",{className:"mt-3",children:[(i==null?void 0:i.length)>0&&s.jsx("h2",{className:"font-semibold mt-3 mb-1",children:"Existing Order"}),(i==null?void 0:i.length)>0&&(i==null?void 0:i.map(e=>s.jsx("div",{className:"border p-2 rounded-md mb-3 w-full",children:s.jsx("div",{className:"flex justify-between items-center",children:s.jsxs("div",{className:"flex justify-between w-full",children:[s.jsx("p",{className:"text-xs lg:text-sm font-semibold text-gray-800 w-3/5",children:e==null?void 0:e.item}),s.jsxs("p",{className:"text-xs lg:text-sm font-medium text-primaryColor w-1/5",children:[e==null?void 0:e.qty,"x",e==null?void 0:e.rate]}),s.jsxs("p",{className:"text-xs lg:text-sm font-medium text-primaryColor w-1/5 text-right",children:["৳",(e==null?void 0:e.qty)*(e==null?void 0:e.rate)]})]})})},e==null?void 0:e.item)))]}),s.jsx("h2",{className:"font-semibold mt-3",children:(i==null?void 0:i.length)>0?"Newly Added":""}),(l==null?void 0:l.length)===0&&s.jsx("div",{className:"flex items-center justify-center h-12 rounded-md border mt-3 text-sm",children:"You haven't added anything to your cart!"}),s.jsx("div",{className:"mt-3",children:l==null?void 0:l.map(e=>s.jsx("div",{className:"border p-2 rounded-md mb-3 w-full",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"flex",children:[s.jsx("img",{src:e!=null&&e.image?e==null?void 0:e.image:"https://images.deliveryhero.io/image/fd-bd/Products/5331721.jpg??width=400",alt:e==null?void 0:e.item_name,className:"h-14 w-14 lg:h-20 lg:w-20 object-cover rounded-lg"}),s.jsxs("div",{className:"flex flex-col items-start justify-center ps-2",children:[s.jsx("p",{className:"text-xs lg:text-sm font-semibold text-gray-800",children:e==null?void 0:e.item_name}),s.jsxs("p",{className:"text-xs lg:text-base font-medium text-primaryColor",children:["৳",e==null?void 0:e.price]}),s.jsx("div",{children:s.jsx("div",{className:"flex items-center ",children:s.jsxs("label",{className:"flex items-center mt-2 text-xs",children:[s.jsx("input",{type:"checkbox",checked:e==null?void 0:e.isParcel,onChange:a=>de(a,e==null?void 0:e.item_code),className:"mr-2"}),"Takeaway"]})})})]})]}),s.jsx("div",{className:"col-span-1 flex flex-col justify-center items-center gap-2",children:s.jsxs("div",{className:"flex",children:[s.jsxs("div",{className:"flex items-center rounded-md border ms-1.5",children:[f[e==null?void 0:e.item_code]===1?s.jsx("button",{onClick:()=>H(e==null?void 0:e.item_code),className:"px-2 rounded-md rounded-e-none text-xs bg-gray-200 cursor-not-allowed h-fit py-2 border",children:s.jsx(X,{className:"text-xs"})}):s.jsx("button",{onClick:()=>H(e==null?void 0:e.item_code),className:"px-2 rounded-md rounded-e-none text-xs bg-gray-200 h-fit py-2 border",children:s.jsx(X,{className:"text-xs"})}),s.jsx("span",{className:"px-2 text-xs h-full flex items-center",children:e==null?void 0:e.quantity}),f[e==null?void 0:e.item_code]>0&&s.jsx("button",{onClick:()=>ne(e==null?void 0:e.item_code),className:"px-2 rounded-md rounded-s-none bg-gray-200 h-fit py-2 border",children:s.jsx(Ce,{className:"text-xs"})})]}),s.jsx("button",{onClick:()=>ce(e==null?void 0:e.item_code),className:"text-redColor px-2 rounded-md text-xs bg-gray-200 h-fit py-2 ms-1.5 border",children:s.jsx(Se,{})})]})})]})},e==null?void 0:e.item_code))}),(l==null?void 0:l.length)>0&&s.jsxs("label",{className:"form-control w-full mt-2",children:[s.jsx("div",{className:"label",children:s.jsx("h2",{className:"font-semibold text-xs",children:"Note"})}),s.jsx("textarea",{value:A,onChange:e=>F(e.target.value),className:"focus:outline-none border rounded-md p-2 text-xs md:text-sm",placeholder:"Special instructions"})]}),(l==null?void 0:l.length)>0&&(i==null?void 0:i.length)===0&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"label",children:s.jsx("h2",{className:"font-semibold text-xs",children:"Coupon"})}),s.jsxs("div",{className:"flex gap-2 w-full text-sm relative",children:[s.jsx("input",{type:"text",value:S,onChange:e=>J(e.target.value),className:`border rounded-md p-1 focus:outline-none px-3 w-full ${y?"border-red-500":""}`,placeholder:"Enter coupon code"}),y&&s.jsx("p",{className:"text-red-500 text-xs right-0 -bottom-5 pt-2 absolute",children:y}),S&&s.jsx("button",{onClick:me,className:"absolute right-3 top-1  px-2 py-1 bg-blue-500 text-xs text-white rounded-md hover:bg-blue-600",children:"Verify"})]})]}),w&&s.jsxs("div",{className:"py-4 flex flex-col items-start",children:[s.jsx("h3",{className:"font-semibold text-sm mb-1",children:"Discount"}),s.jsxs("div",{className:"flex gap-2 w-full text-sm relative",children:[s.jsxs("select",{value:C,onChange:he,className:"border rounded-md p-1 focus:outline-none px-2",children:[s.jsx("option",{value:"percentage",children:"Percentage"}),s.jsx("option",{value:"flat",children:"Flat Amount"})]}),s.jsx("input",{type:"number",value:u,onChange:ie,className:`border rounded-md p-1 focus:outline-none px-3 w-full ${y?"border-red-500":""}`,placeholder:`Enter ${C==="percentage"?"percentage":"flat amount"}`}),y&&s.jsx("p",{className:"text-red-500 text-xs right-0 -bottom-5 pt-2 absolute",children:y})]})]}),(l==null?void 0:l.length)>0&&s.jsxs("div",{className:"p-3 border rounded-md mt-5",children:[s.jsxs("div",{className:"flex justify-between text-xs md:text-sm",children:[s.jsx("h1",{children:"Subtotal"}),s.jsxs("h1",{children:["৳",v.toFixed(2)]})]}),Number(u)>0&&s.jsxs("div",{className:"flex justify-between text-xs md:text-sm mt-2",children:[s.jsx("h1",{children:"Discount (%)"}),s.jsxs("h1",{children:["৳",u]})]}),s.jsxs("div",{className:"flex justify-between text-xs md:text-sm mt-2",children:[s.jsxs("h1",{children:["Tax (",U*100,"%)"]}),s.jsxs("h1",{children:["৳",L.toFixed(2)]})]}),s.jsxs("div",{className:"flex justify-between text-xs md:text-sm font-semibold mt-2",children:[s.jsx("h1",{children:"Payable Amount"}),s.jsxs("h1",{children:["৳",P.toFixed(2)]})]})]})]}),oe.length!==0&&s.jsx("div",{className:`p-4 py-2 border bottom-0 absolute w-full bg-white ${O?"rounded-b-lg":""}`,children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("p",{className:"text-sm font-semibold",children:["Total Payable Amount : ৳",P.toFixed(2)]}),s.jsx("button",{onClick:re,className:"bg-primaryColor p-2 px-4 rounded-md text-white h-fit text-sm",children:"Checkout"})]})}),M&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center px-3",style:{zIndex:999},children:s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Confirm Checkout"}),s.jsxs("label",{className:"block mb-2",children:["Full Name (optional)",s.jsx("input",{type:"text",value:E,onChange:e=>se(e.target.value),className:"w-full border rounded p-2 mt-1"})]}),s.jsxs("div",{className:"flex justify-end mt-4",children:[s.jsx("button",{onClick:()=>z(!1),className:"mr-2 bg-gray-200 px-4 py-2 rounded",children:"Cancel"}),s.jsx("button",{onClick:xe,className:"bg-primaryColor px-4 py-2 rounded text-white",children:"Confirm"})]})]})})]})},Ee=({children:d,isOpen:n,isLargeDevice:c})=>c?s.jsx("div",{style:{zIndex:999},className:`fixed inset-0 z-50 flex items-center justify-center p-4  ${n?"bg-black bg-opacity-50":"hidden"}`,children:s.jsx("div",{className:`bg-white rounded-lg shadow-lg transition-transform duration-500 ease-in-out ${n?"scale-100":"scale-0"} md:max-w-lg w-full h-auto`,children:d})}):s.jsx("div",{className:"h-[100vh] w-full",style:{zIndex:999},children:s.jsx("div",{style:{zIndex:999},className:`drawer-bottom bg-white shadow-lg transition-transform duration-500 ease-in-out z-50 ${n?"translate-y-0":"translate-y-full"} fixed bottom-0 left-0 w-full min-h-full `,children:d})}),Ae=({className:d})=>{const[n,c]=x.useState(!1),[w,l]=x.useState(!1),{cartCount:m}=B(),f=()=>{l(!1)};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`bg-gray flex py-2 justify-evenly px-0 sm:px-24 sm:justify-between items-center gap-2 bottom_nav p-2 pb-5 pt-5 ${d}`,children:[s.jsxs(Q,{to:"/",className:"flex flex-col p-2 justify-center items-center cursor-pointer",children:[s.jsx(_e,{size:15}),s.jsx("p",{className:"text-xs text-gray-light",children:"Home"})]}),s.jsxs(Q,{to:ke(),className:"flex flex-col justify-center items-center p-2 cursor-pointer",children:[s.jsx(Le,{size:15}),s.jsx("p",{className:"text-xs text-gray-light",children:"All"})]}),s.jsx("div",{className:"relative",children:s.jsxs("button",{onClick:()=>{c(!0)},className:`flex flex-col justify-center items-center p-2 cursor-pointer ${n?"active":""}`,children:[s.jsx(Pe,{size:15}),s.jsx("p",{className:"text-xs text-gray-light",children:"Cart"}),s.jsx("div",{className:Fe("absolute top-0 right-0 h-4 w-4 bg-primaryColor rounded-full flex justify-center items-center text-white text-xs",{"top-1 right-3":n}),children:m})]})})]}),n&&s.jsx(ze,{isOpen:n,toggleDrawer:()=>c(!1),setShowPopup:l}),w&&s.jsx(qe,{handleClosePopup:f})]})};export{Ae as B};
